@{
    ViewBag.Title = "ProjectFileUpload";
    if (ViewData["id"].ToString() == "1")
    {
        Layout = "~/Views/Shared/_Home.cshtml";
    }
    else if (ViewData["id"].ToString() == "2")
    {
        Layout = "~/Views/Shared/Admin.cshtml";
    }
    else if (ViewData["id"].ToString() == "3")
    {
        Layout = "~/Views/Shared/Normal.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/CSR.cshtml";
    }
}
<link href="~/Content/UploadFile.css" rel="stylesheet" />
<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Project  Files</h1>
        </div>
        <!-- /.col-lg-12 -->
        <div class="col-lg-12">
            <div class="col-lg-4">
                <h3>Customer Name :<label id="customername"></label></h3>
            </div>
            <div class="col-lg-4">
                <h3>Project Name : <label id="projectname"></label></h3>
            </div>
            <div class="col-lg-4">
                <h3>Work Order : <label id="work"></label></h3>

            </div>
        </div>
    </div>

    <!-- /.row -->
    <div class="container" id="xyz">


        <ul class="tabs">
            <li class="tab-link current" data-tab="tab-5" onclick="call(4)">Project</li>
            <li class="tab-link  " data-tab="tab-1" onclick="call(0)">Team</li>
            <li class="tab-link " data-tab="tab-2" onclick="call(1)">Task</li>
            <li class="tab-link" data-tab="tab-3" onclick="call(2)">Files</li>
            <li class="tab-link" data-tab="tab-4" onclick="call(3)">Ticket</li>
            <li class="tab-link" data-tab="tab-6" onclick="call(5)">Requisition</li>

        </ul>
        <div id="tab-1" class="tab-content overflow  ">

            @************************************* Team ********************************************@
            <table class="table table-striped table-bordered table-hover" id="dataTables-exampl" style="width:100%!important">
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>User Number</th>
                        <th>User Address</th>
                    </tr>
                </thead>
                <tbody id="dynamic-Grid"></tbody>
            </table>


        </div>
        @************************************* Task ********************************************@
        <div id="tab-2" class="tab-content overflow ">
            <table class="table table-striped table-bordered table-hover" id="dataTables-examp" style="width:100%!important">
                <thead id="th">
                    <tr>
                        <th>Task Id</th>
                        <th>Task Name</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                    </tr>
                </thead>
                <tbody id="dynamic-Grid"></tbody>
            </table>
        </div>
        @************************************* File ********************************************@
        <div id="tab-3" class="tab-content overflow">
            <div>
                <table class="table table-striped table-bordered table-hover" id="dataTables-exam" style="width:100%!important;">
                    <thead id="th">
                        <tr>
                            <th>File Code</th>
                            <th>Type</th>
                            <th>Uploaded By</th>
                            <th>Upload Date</th>
                            <th>Upload Time</th>
                            <th>Download</th>
                        </tr>
                    </thead>
                    <tbody id="dynamic-Grid"></tbody>
                </table>
            </div>
        </div>
        @************************************* Ticket ********************************************@
        <div id="tab-4" class="tab-content overflow ">
            <table class="table table-striped table-bordered table-hover" id="dataTables-exa" style="width:100%!important">
                <thead id="th">
                    <tr>
                        <th>Ticket No.</th>
                        <th>Ticket Name</th>
                        <th>Branch Code / Location</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="dynamic-Grid"></tbody>
            </table>
        </div>
        @************************************* Project ********************************************@
        <div id="tab-5" class="tab-content overflow current">
            <table class="table  table-striped table-bordered table-hover">
                <tbody>
                    <tr>
                        <td>Work Order</td>
                        <td id="workorder"></td>
                    </tr>
                    <tr>
                        <td>Product</td>
                        <td id="product"></td>

                    </tr>
                    <tr>
                        <td>Nature Of Work</td>
                        <td id="worktype"></td>

                    </tr>
                    <tr>
                        <td>Customer</td>
                        <td id="Customer"></td>

                    </tr>
                    <tr>
                        <td>Name</td>
                        <td id="name"> </td>

                    </tr>
                    <tr>
                        <td>Created On</td>
                        <td id="createdon"> </td>

                    </tr>
                    <tr>
                        <td>Start Date</td>
                        <td id="sdaTE"> </td>

                    </tr>
                    <tr>
                        <td>End Date</td>
                        <td id="edate"> </td>

                    </tr>
                    <tr>
                        <td>Project Manager</td>
                        <td id="projManager"> </td>

                    </tr>

                    <tr>
                        <td>Customer Manager</td>
                        <td id="custmanager"> </td>

                    </tr>
                    <tr>
                        <td>Customer Email</td>
                        <td id="custEmail"> </td>

                    </tr>
                    <tr>
                        <td>Customer Mobile No</td>
                        <td id="custMObile"> </td>

                    </tr>
                    <tr>
                        <td>Customer Address</td>
                        <td id="custAdd"> </td>

                    </tr>
                </tbody>
            </table>



        </div>
        @************************************* Requisition ********************************************@
        <div id="tab-6" class="tab-content overflow">
            <div>
                <table class="table table-striped table-bordered table-hover" id="dataTables-examples" style="width:100%!important;">
                    <thead id="th">
                        <tr>
                            <th>S No.</th>
                            <th>Item Name</th>
                            <th>Item Code</th>
                            <th>Quantity</th>
                            <th>Request By</th>
                            <th>Approve By</th>
                            <th>View</th>
                        </tr>
                    </thead>
                    <tbody id="dynamic-Grid"></tbody>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="pull-left" id="uplodbtn">
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" id="btn" onclick="myFunction()">Upload File</button>
                <button type="button" class="btn btn-primary btn-lg" onclick="immediateTask()" style="margin-top:20px">Add Task</button>
                <button type="button" class="btn btn-warning btn-lg" data-toggle="modal" data-target="#myModal1" style="margin-top:20px" onclick="requisition()">Requisition</button>
            </div>
        </div>

    </div><!-- container -->
</div>
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="closeModal" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title center "> File Upload</h4>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div>
                                <div class="col-lg-12 spacing">
                                    <div class="col-lg-6 ">
                                        <label>File Name</label>
                                    </div>
                                    <div class="col-lg-6 ">
                                        <select id="FileCatogreyDropdown" class="form-control">
                                            <option value="00">Please Select File Name</option>
                                            <option value="01">Internal Work Order</option>
                                            <option value="02">Customer Purchase Order</option>
                                            <option value="03">Quotation</option>
                                            <option value="04">Local Purchase Order</option>
                                            <option value="05">Work Completion</option>
                                            <option value="06">Progress Report</option>
                                            <option value="07">Project Budget</option>
                                            <option value="08">Project Expense</option>
                                            <option value="09">Project Shedule</option>
                                            <option value="10">Project Invoice</option>
                                            <option value="11">Project Material Requisition</option>
                                            <option value="12">Delivery Challan</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-12 spacing">
                                    <div class="col-lg-6">
                                        <label>File</label>
                                    </div>
                                    <div class="col-lg-6">
                                        <div>
                                            <input name="myFile" type="file" id="images" accept=".xls,.xlsx,.docx,.pdf,.jpg,.png" onclick="myFunction()" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-12 ">
                                    <div class="col-lg-offset-6 col-lg-6">
                                        <label style="color:Red" id="noti" class="">

                                        </label>
                                    </div>
                                    <div class="col-lg-offset-6 col-lg-6 spacing">
                                        <button class="btn btn-success" value="Add" onclick="Add()"> Save </button>
                                    </div>
                                </div>


                            </div>

                        </div>

                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<div id="myModal1" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="closeModal" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title center "> Requisition </h4>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="col-lg-12">

                        <table class="table table-striped table-bordered table-hover" id="viewReq" style="width:100%!important; height:100%!important;">
                            <thead id="th">
                                <tr>
                                    <th>Item Name</th>
                                    <th>Item Code</th>
                                    <th>Quantity</th>
                                    <th>Approve</th>
                                    <th style="display:none;">id</th>
                                </tr>
                            </thead>
                            <tbody id="dynamic-Grid"></tbody>
                        </table>
                        <div class="col-lg-12" style=" border: 1px solid gray;">
                            <div class="col-lg-4">Note</div>
                            <div class="col-lg-8"><textarea id="notefield1" class="form-control" rows="4"></textarea></div>
                        </div>
                        <button class="btn btn-success pull-right" onclick="approveReq()" style="margin-bottom: 10px;"> Approve Now</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        approveditems = [];
        document.getElementById("project").style.backgroundColor = "bisque";
        $('ul.tabs li').click(function () {
            var tab_id = $(this).attr('data-tab');

            $('ul.tabs li').removeClass('current');
            $('.tab-content').removeClass('current');

            $(this).addClass('current');
            $("#" + tab_id).addClass('current');
        })
        call(4);
    });

    function call(id) {
        $.ajax({
            async: false,
            url: '/api/ProjectFilesUpload/' + id,
            type: 'GET',
            success: function (data) {
                console.log(data);
                document.getElementById("customername").innerHTML = data[1].cname;
                document.getElementById("projectname").innerHTML = data[1].pname;
                document.getElementById("work").innerHTML = data[1].workorder;

                if (id == 0) {
                    table = $("#dataTables-exampl").DataTable({
                        "aaData": data[0],
                        "bDestroy": true,
                        "aoColumns": [
                            { "mDataProp": "Name" },
                            { "mDataProp": "Number" },
                            { "mDataProp": "Address" },
                            { "mDataProp": "id" }

                        ]
                    });


                }
                else if (id == 1) {
                    table = $("#dataTables-examp").DataTable({
                        "aaData": data[0],
                        "bDestroy": true,
                        "aoColumns": [
                            { "mDataProp": "task_No" },
                            { "mDataProp": "task_Name" },
                            { "mDataProp": "start_Date" },
                            { "mDataProp": "end_Date" }
                        ]
                    });

                }
                else if (id == 2) {
                    table = $("#dataTables-exam").DataTable({
                        "aaData": data[0],
                        "bDestroy": true,
                        "aoColumns": [
                            { "mDataProp": "fileCode" },
                            { "mDataProp": "file_type_name" },
                            { "mDataProp": "uploaded_user" },
                            { "mDataProp": "uploaded_date" },
                            { "mDataProp": "uploaded_time" },
                            { "mDataProp": "Download" }
                        ]
                    });

                }
                else if (id == 3) {
                    table = $("#dataTables-exa").DataTable({
                        "aaData": data[0],
                        "bDestroy": true,
                        "aoColumns": [
                            { "mDataProp": "ticket_code" },
                            { "mDataProp": "ticket_Name" },
                            { "mDataProp": "branch" },
                            { "mDataProp": "description" }
                        ]
                    });

                }
                else if (id == 4) {
                    document.getElementById("workorder").innerHTML = data[0].workorder;
                    document.getElementById("projManager").innerHTML = data[0].projectManager;
                    document.getElementById("product").innerHTML = data[0].productCategory;
                    document.getElementById("worktype").innerHTML = data[0].natureofWork;
                    document.getElementById("Customer").innerHTML = data[0].customerName;
                    document.getElementById("name").innerHTML = data[0].projectName;
                    document.getElementById("createdon").innerHTML = data[0].createdOn;
                    document.getElementById("sdaTE").innerHTML = data[0].startDate;
                    document.getElementById("edate").innerHTML = data[0].endDate;
                    document.getElementById("custmanager").innerHTML = data[0].customerManager;
                    document.getElementById("custEmail").innerHTML = data[0].Email;
                    document.getElementById("custMObile").innerHTML = data[0].PhoneNumber;
                    document.getElementById("custAdd").innerHTML = data[0].address;
                }
                else {
                    table = $("#dataTables-examples").DataTable({
                        "aaData": data[0],
                        "bDestroy": true,
                        "aoColumns": [
                            { "mDataProp": "MRI" },
                            { "mDataProp": "itemName" },
                            { "mDataProp": "itemCode" },
                            { "mDataProp": "qunantity" },
                            { "mDataProp": "request" },
                            { "mDataProp": "approve" },

                            { "mDataProp": "view" }
                        ]
                    });


                }

            },
            error: function () {
                alert('Detail Updated');
            }
        });

    }

    $('#images').on('change', function (e) {

        var files = e.target.files;
        var imgbytes = document.getElementById('images').files[0].size;
        var size = imgbytes / 1048576;
        if (files.length > 0 && size <= 2) {
            if (window.FormData !== undefined) {
                ImageData = new FormData();
                for (var x = 0; x < files.length; x++) {
                    ImageData.append("file" + x, files[x]);
                }
            }
        }
        else {
            document.getElementById("noti").innerText = "File Size not Allowed! Max. 2 MB is Allowed";
            document.getElementById("images").value = "";
        }
    });

    function Deletefile(id) {
        $.ajax({
            async: false,
            url: '/api/projectupdate/' + id,
            type: "Put",
            success: function (data) {
                alert("File Deleted");
                call(2);
            },
            error: function () {
                alert("error");
            }
        });
    }

    function Add() {
        document.getElementById("noti").value = "";
        var dropdowntype = document.getElementById("FileCatogreyDropdown").value.trim();
        var file = document.getElementById("images").value;
        if (dropdowntype == "00") {
            alert("Please Select File Name");
        }
        else if (file == "") {
            alert("Please Upload File")
        }
        else {
            var model = { fileName: file, fileCode: dropdowntype };
            console.log(file + "" + dropdowntype);
            $.ajax({
                async: false,
                url: '/api/ProjectFilesUpload/',
                type: 'POST',
                data: JSON.stringify(model),
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $.ajax({
                        url: '/api/UploadFileApi/',
                        type: "POST",
                        contentType: false,
                        processData: false,
                        data: ImageData,
                        success: function (result) {
                            document.getElementById("noti").innerText = "File Saved Successfully!";
                        },
                        error: function (xhr, status, p3, p4) {
                            var err = "Error " + " " + status + " " + p3 + " " + p4;
                            if (xhr.responseText && xhr.responseText[0] == "{")
                                err = JSON.parse(xhr.responseText).Message;
                            console.log(err);
                        }
                    });

                    //
                },
                error: function () {
                    alert("File Not Saved");
                }
            });
        }
    }

    function myFunction() {
        document.getElementById("noti").innerText = "";
    }

    function immediateTask() {
        $.ajax({
            async: false,
            url: '/api/ProjectApi/' + 0,
            type: "POST",
            success: function (data) {
                window.location.href = '/Task/CreateTask';
            },
            error: function () {
                alert("error");
            }
        });
    }
    function requisition() {
        $.ajax({
            async: false,
            url: '/api/ProjectApi/' + 0,
            type: "POST",
            success: function (data) {
                window.location.href = '/Requisition/CreateRequisition';
            },
            error: function () {
                alert("error");
            }
        });
    }

    function status(val, id) {
        var model = { value: val, user: id };
        console.log(model);
        $.ajax({
            async: true,
            url: '/api/angularApi/',
            type: 'PUT',
            data: JSON.stringify(model),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                console.log("success");
            },
            error: function () { console.log("Code Not Ok!"); }
        });
    }

    function viewRequisition(id) {
        $.ajax({
            async: true,
            url: '/api/ProjectFilesUpload/' + id,
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                console.log(data);
                modaltable(data);
            },
            error: function () { alert("Code Not Ok!"); }
        });
    }


    function modaltable(datas) {
        $("#viewReq").DataTable({
            "searching": false,
            "paging": false,
            "aaData": datas,
            "bDestroy": true,
            "aoColumns": [
                 { "mDataProp": "itemName" },
                 { "mDataProp": "itemCode" },
                { "mDataProp": "qunantity" },
                { "mDataProp": "approve" }
            ]
        });


    }
    function approveReq() {

        if (approveditems.length == 0) {
            alert("You must approve a few item(s) before approving Reuisition!");
            return;
        }
        var notef = document.getElementById("notefield1").value;
        if (notef == '') {
            alert("You must approve in note, breifing about requisition decision!");
            return;
        }
        //pass the below model (y)! :)
        var model = { note: notef, items: approveditems };
        console.log(model);
        $.ajax({
            url: '/api/RequisitionApi/',
            type: 'PUT',
            data: JSON.stringify(model),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
              
                console.log("success");
            },
            error: function () { console.log("Code Not Ok!"); }
        });

    }

    function fillReqItems(id) {

        var check = false;
        for (var i = 0; i < approveditems.length; i++) {
            if (approveditems[i] == id) {
                check = true;
                approveditems.splice(i, 1);
                break;

            }
        }
        if (!check) {
            approveditems.push(id);
        }

    }


</script>
