@{
    ViewBag.Title = "CreateTask";
    if (ViewData["id"].ToString() == "1")
    {
        Layout = "~/Views/Shared/_Home.cshtml";
    }
    else if (ViewData["id"].ToString() == "2")
    {
        Layout = "~/Views/Shared/Admin.cshtml";
    }
    else if (ViewData["id"].ToString() == "3")
    {
        Layout = "~/Views/Shared/Normal.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/CSR.cshtml";
    }
}
<link href="~/Content/select2.css" rel="stylesheet" />
<link href="~/Content/select2-bootstrap.css" rel="stylesheet" />
<div id="wrapper">
    <!-- Navigation -->
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header" style="text-align:center">Create Task</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row" ng-app="task">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Create Task
                    </div>
                    <div class="panel-body" ng-controller="taskctrl">
                        <form ng-submit="Add()" id="taskForm">
                            <div class="row">
                                <div class=" col-lg-offset-3 col-lg-6">
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6 ">
                                            <label>Name</label>
                                            <input type="hidden" ng-model="task.id" />
                                        </div>
                                        <div class="col-lg-6 ">
                                            <input type="hidden" id="cust_id" value="0" />
                                            <input class="form-control" type="text" ng-model="task.taskname" required="required">
                                        </div>
                                    </div>

                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6 ">
                                            <label>Customer Name</label>
                                        </div>
                                        <div class="col-lg-6 ">
                                            <select ng-options="customer.name for customer in task.dropcustomer" ng-if="!task.fromProj" ng-model="customerId" class="ddl" ng-change="selectionChange()" required="required" ng-disabled="check"></select>
                                            <input class="form-control" type="text" data-ng-if="task.fromProj" ng-model=" task.customerName" required="required" disabled>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>Project Name</label>
                                        </div>
                                        <div class="col-lg-6 ">
                                            <select ng-options="project.name for project in task.dropproject" ng-if="!task.fromProj"  ng-model="projectId" class="ddl " required="required" ng-disabled="check"></select>
                                            <input class="form-control" type="text" data-ng-if="task.fromProj" ng-model="task.projectName" required="required" disabled>
                                         </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>Description</label>
                                        </div>
                                        <div class="col-lg-6">
                                            <textarea class="form-control" type="text" cols="22" rows="2" ng-model="task.issue" required="required"> </textarea>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>Start Date</label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" type="date" name="StartDate" ng-model="task.sdate" required="required">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>End Date</label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" type="date" name="EndDate" ng-model="task.edate" required="required">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>Assigned To</label>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="dropdown">
                                                <multiple-autocomplete ng-model="selectedList"
                                                                       object-property="name"
                                                                       suggestions-arr="optionsList">
                                                </multiple-autocomplete>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 spacing">
                                        <div class="col-lg-6">
                                            <label>Reminder</label>
                                        </div>
                                        <div class="col-lg-6">
                                            <label class="checkbox-inline">
                                                <input type="checkbox" ng-model="task.sms" ng-checked="task.sms"> SMS
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" ng-model="task.email" ng-checked="task.email">  Email
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-offset-6 col-lg-6 spacing">
                                        <input type="submit" class="btn btn-success" value="Create/Update" />
                                        <input type="button" class="btn btn-info" value="Reset" onclick="location.reload();">
                                    </div>

                                </div>
                  
                            </div>
                        </form>
                        
                    </div>
                   
                </div>
     
            </div>
     
        </div>

    </div>

</div>

<script src="~/Scripts/angular.min.js"></script>
<script type="text/javascript">

    var app = angular.module("task", ['multipleSelect']);
    app.controller("taskctrl", function ($scope, $http) {
        $scope.message = $http.get('/api/TaskApi/' + 0).then(function (response) {

            console.log(response.data);
            $scope.task = response.data;
            console.log(response.data);
            console.log($scope.check);
            $scope.check = false;
            console.log($scope.check);
            $scope.selectedList = $scope.task.tags;
            $scope.optionsList = $scope.task.list;
            $scope.originalProjects = $scope.task.dropproject;

            for (var i = 0; i < $scope.task.dropcustomer.length; i++) {
                if ($scope.task.cid == $scope.task.dropcustomer[i].id) {
                    $scope.customerId = $scope.task.dropcustomer[i];
                }
            }

            for (var i = 0; i < $scope.task.dropproject.length; i++) {
                if ($scope.task.pid == $scope.task.dropproject[i].id) {
                    $scope.projectId = $scope.task.dropproject[i];
                }
            }

            if ($scope.task.id > 0) {
                $scope.task.sdate = new Date($scope.task.sdate);
                $scope.task.edate = new Date($scope.task.edate);
            }
            else
            {
                $scope.task.sdate = new Date();
                $scope.task.edate = new Date();
            }

            
            
        });
       

        $scope.selectionChange = function () {
            $scope.task.dropproject = [];
           
            var id = this.customerId.id;
      
            angular.forEach($scope.originalProjects, function (item) {
                if (item.custId == id) {
       
                    $scope.task.dropproject.push(item);
                }
            });

        }
        $scope.Add = function () {
            if ($scope.task.sdate > $scope.task.edate) {
                alert("Please Enter Corrct Date ");
                return;
            }
            else {
                if (!$scope.task.fromProj)
                {
                    $scope.task.pid = $scope.projectId.id;
                }
           $scope.message = $http.post('/api/TaskApi/', $scope.task).then(function (response) {

                    alert("Task Added Sucessfully");
                    if ($scope.task.fromProj) {
                        
                        window.history.back();
                    }
                    else {
                        window.location.href = '/Task/ViewTask';
                        document.getElementById("taskForm").reset();
                        $scope.selectedList = [];
                        $scope.customerId = {};
                        $scope.projectId = {};
                    }
                });
            }
        }

        $scope.getval = function (val) {
            $scope.projecttemp = [];
            for (var i = 0; i < $scope.projects.length; i++) {
                if ($scope.projects[i].custId == val.value) {
                    $scope.pojecttemp.push($scope.projects[i]);
                }
            }

        }
    });



</script>